# TableAgent - Планировщик задач

## Обзор проекта
**Цель**: Создать ИИ-агента для работы с Excel файлами из Google Drive, который может отвечать на вопросы о содержимом таблиц через веб-интерфейс.

**Структура данных**:
- Excel файл с 2 колонками:
  1. Название инструмента (например, "Шахматка бронирования")
  2. Ссылка на раздел сайта realtycalendar.ru

---

## Уровень 1: Планирование и архитектура

### 1.1 Анализ требований ✅
- [x] Определить основную функциональность
- [x] Проанализировать структуру данных
- [x] Исследовать доступные технологии
- [x] Создать техническое задание

### 1.2 Выбор технологического стека
- [ ] **Backend**: Python + FastAPI
- [ ] **Google Drive**: Google Drive API v3 + google-api-python-client
- [ ] **Excel обработка**: pandas + openpyxl
- [ ] **ИИ**: OpenAI API
- [ ] **Frontend**: Open WebUI
- [ ] **Аутентификация**: OAuth 2.0 для Google Drive
- [ ] **База данных**: SQLite (для кэширования)

### 1.3 Архитектура системы
```
TableAgent/
├── backend/
│   ├── services/
│   │   ├── google_drive_service.py    # Работа с Google Drive API
│   │   ├── excel_processor.py         # Обработка Excel файлов
│   │   └── ai_agent.py               # ИИ-агент для ответов
│   ├── api/
│   │   ├── __init__.py
│   │   ├── routes.py                 # REST API endpoints
│   │   └── auth.py                   # Аутентификация
│   ├── models/
│   │   ├── __init__.py
│   │   └── data_models.py            # Pydantic модели
│   ├── config/
│   │   ├── __init__.py
│   │   ├── settings.py              # Настройки приложения
│   │   └── credentials.json         # Google API credentials
│   └── main.py                      # Точка входа FastAPI
├── frontend/
│   ├── webui/                       # Open WebUI интеграция
│   └── static/                      # Статические файлы
├── tests/
│   ├── __init__.py
│   ├── test_google_drive.py
│   ├── test_excel_processor.py
│   └── test_ai_agent.py
├── docs/
│   ├── api_documentation.md
│   └── deployment_guide.md
├── requirements.txt
├── .env.example
└── README.md
```

### 1.4 План разработки
1. **Этап 1**: Настройка окружения и базовой структуры
2. **Этап 2**: Интеграция с Google Drive API
3. **Этап 3**: Обработка Excel файлов
4. **Этап 4**: Создание ИИ-агента
5. **Этап 5**: Веб-интерфейс (Open WebUI)
6. **Этап 6**: Тестирование и оптимизация

---

## Уровень 2: Реализация механизма взаимодействия с Google Drive

### 2.1 Настройка Google Drive API
- [ ] Создать проект в Google Cloud Console
- [ ] Включить Google Drive API
- [ ] Создать Service Account
- [ ] Скачать credentials.json
- [ ] Настроить права доступа к папке с Excel файлами

### 2.2 Реализация Google Drive Service
- [ ] Создать класс `GoogleDriveService`
- [ ] Реализовать аутентификацию через Service Account
- [ ] Добавить методы:
  - [ ] `list_files()` - список файлов в папке
  - [ ] `download_file(file_id)` - скачивание файла
  - [ ] `get_file_info(file_id)` - информация о файле
  - [ ] `search_files(query)` - поиск файлов

### 2.3 Обработка Excel файлов
- [ ] Создать класс `ExcelProcessor`
- [ ] Реализовать методы:
  - [ ] `read_excel(file_path)` - чтение Excel файла
  - [ ] `validate_structure(df)` - проверка структуры данных
  - [ ] `clean_data(df)` - очистка данных
  - [ ] `to_json(df)` - конвертация в JSON

### 2.4 Интеграция с Open WebUI
- [ ] Установить и настроить Open WebUI
- [ ] Создать кастомный плагин для TableAgent
- [ ] Реализовать веб-интерфейс для:
  - [ ] Выбора Excel файла из Google Drive
  - [ ] Просмотра содержимого таблицы
  - [ ] Настройки параметров

---

## Уровень 3: Создание ИИ-агента

### 3.1 Настройка ИИ-модели
- [ ] Выбрать модель (OpenAI GPT-4 или локальная через Ollama)
- [ ] Настроить API ключи
- [ ] Создать промпт-шаблоны для работы с данными

### 3.2 Реализация AI Agent
- [ ] Создать класс `TableAgent`
- [ ] Реализовать методы:
  - [ ] `load_data(file_id)` - загрузка данных из Google Drive
  - [ ] `process_question(question)` - обработка вопроса
  - [ ] `generate_answer(question, context)` - генерация ответа
  - [ ] `get_tool_info(tool_name)` - информация об инструменте

### 3.3 Типы вопросов и ответов
- [ ] **"Объясни инструмент X"** - описание инструмента
- [ ] **"Покажи все инструменты"** - список всех инструментов
- [ ] **"Найди инструмент по ключевому слову"** - поиск
- [ ] **"Дай ссылку на инструмент X"** - получение ссылки
- [ ] **"Какие инструменты связаны с Y"** - фильтрация

### 3.4 Контекстная обработка
- [ ] Создать систему контекста для ИИ
- [ ] Реализовать кэширование часто задаваемых вопросов
- [ ] Добавить валидацию ответов

---

## Дополнительные задачи

### Тестирование
- [ ] Unit тесты для всех сервисов
- [ ] Integration тесты для Google Drive API
- [ ] Тесты для ИИ-агента
- [ ] E2E тесты для веб-интерфейса

### Документация
- [ ] API документация (Swagger/OpenAPI)
- [ ] Руководство пользователя
- [ ] Руководство разработчика
- [ ] Примеры использования

### Развертывание
- [ ] Docker контейнеризация
- [ ] Настройка CI/CD
- [ ] Конфигурация для production
- [ ] Мониторинг и логирование

---

## Критерии успеха

### Функциональные требования
- [ ] Успешное подключение к Google Drive
- [ ] Корректное чтение Excel файлов
- [ ] Работающий ИИ-агент с точными ответами
- [ ] Интуитивный веб-интерфейс

### Технические требования
- [ ] Время ответа < 5 секунд
- [ ] Обработка файлов до 10MB
- [ ] Поддержка до 1000 записей в таблице
- [ ] 99% uptime

### Пользовательские требования
- [ ] Простота использования
- [ ] Понятные ответы ИИ
- [ ] Быстрая навигация по данным
- [ ] Мобильная адаптация

---

## Риски и митигация

### Технические риски
- **Google API лимиты** → Кэширование и оптимизация запросов
- **Производительность ИИ** → Выбор оптимальной модели
- **Безопасность данных** → Шифрование и безопасная аутентификация

### Проектные риски
- **Сложность интеграции** → Поэтапная разработка
- **Изменение требований** → Гибкая архитектура
- **Временные ограничения** → Приоритизация задач

---

## Временные рамки

- **Уровень 1**: 1-2 дня (планирование)
- **Уровень 2**: 3-5 дней (Google Drive + WebUI)
- **Уровень 3**: 2-3 дня (ИИ-агент)
- **Тестирование и полировка**: 1-2 дня

**Общее время**: 7-12 дней

---

*Последнее обновление: [Дата]*
*Статус: В разработке*
