# TableAgent - Планировщик задач

## Обзор проекта
**Цель**: Создать ИИ-агента для работы с Google Sheets, который может отвечать на вопросы о содержимом таблиц через веб-интерфейс.

**Структура данных**:
- Google Sheets таблица с 2 колонками:=
  1. Название инструмента (например, "Шахматка бронирования")
  2. Ссылка на раздел сайта realtycalendar.ru

**Текущий статус**: ✅ Уровень 2 выполнен - ИИ-агент работает с Google Sheets

---

## Уровень 1: Планирование и архитектура

### 1.1 Анализ требований ✅
- [x] Определить основную функциональность
- [x] Проанализировать структуру данных
- [x] Исследовать доступные технологии
- [x] Создать техническое задание

### 1.2 Выбор технологического стека ✅
- [x] **Backend**: Python + FastAPI
- [x] **Google Sheets**: Google Sheets API + google-api-python-client
- [x] **ИИ**: glm-4.5-flash через OpenAI API (z.ai)
- [x] **Frontend**: Open WebUI (следующий этап)
- [x] **Аутентификация**: OAuth 2.0 для Google Sheets
- [ ] **База данных**: SQLite (для кэширования) - опционально

### 1.3 Архитектура системы ✅
```
TableAgent/
├── src/
│   ├── services/
│   │   ├── google_sheets_service.py  # Работа с Google Sheets API ✅
│   │   └── ai_agent.py              # ИИ-агент для ответов ✅
│   ├── config/
│   │   ├── settings.py              # Настройки приложения ✅
│   │   └── model_config.py          # Конфигурация модели ✅
│   └── models/                      # Pydantic модели (встроены в API)
├── tests/
│   ├── test_connection.py           # Тест подключения ✅
│   └── test_ai_agent.py            # Тест ИИ-агента ✅
├── main.py                         # FastAPI приложение ✅
├── requirements.txt                # Зависимости ✅
├── .env                           # Переменные окружения ✅
└── PROJECT_PLAN.md               # Этот файл ✅
```

### 1.4 План разработки ✅
1. **Этап 1**: Настройка окружения и базовой структуры ✅
2. **Этап 2**: Интеграция с Google Sheets API ✅
3. **Этап 3**: Создание ИИ-агента ✅
4. **Этап 4**: Веб-интерфейс (Open WebUI) - следующий
5. **Этап 5**: Тестирование и оптимизация

---

## Уровень 2: Реализация механизма взаимодействия с Google Sheets ✅

### 2.1 Настройка Google Sheets API ✅
- [x] Создать проект в Google Cloud Console
- [x] Включить Google Sheets API
- [x] Создать OAuth 2.0 Client ID
- [x] Скачать credentials.json
- [x] Настроить доступ к Google Sheets таблице

### 2.2 Реализация Google Sheets Service ✅
- [x] Создать класс `GoogleSheetsService`
- [x] Реализовать аутентификацию через OAuth 2.0
- [x] Добавить методы:
  - [x] `get_sheet_data(spreadsheet_id, range)` - получение данных
  - [x] `get_tools_data(spreadsheet_id)` - структурированные данные
  - [x] `find_tool_by_name(spreadsheet_id, name)` - поиск инструмента

### 2.3 Обработка данных ✅
- [x] Парсинг данных из Google Sheets
- [x] Валидация структуры (название + ссылка)
- [x] Форматирование для ИИ-агента
- [x] Пропуск заголовков таблицы

### 2.4 FastAPI интеграция ✅
- [x] Создать REST API endpoints
- [x] Интеграция с Google Sheets Service
- [x] Обработка ошибок и валидация
- [x] Тестирование через Postman

---

## Уровень 3: Создание ИИ-агента ✅

### 3.1 Настройка ИИ-модели ✅
- [x] Выбрать модель: glm-4.5-flash через z.ai API
- [x] Настроить API ключи и base_url
- [x] Создать конфигурацию модели (ModelConfig)
- [x] Создать промпт-шаблоны на русском языке

### 3.2 Реализация AI Agent ✅
- [x] Создать класс `AIAgent`
- [x] Реализовать методы:
  - [x] `answer_question(question, tools_data)` - обработка вопроса
  - [x] `_format_tools_context(tools_data)` - форматирование контекста
  - [x] Интеграция с glm-4.5-flash API
  - [x] Обработка ошибок API

### 3.3 Типы вопросов и ответов ✅
- [x] **"Объясни инструмент X"** - описание инструмента
- [x] **"Покажи все инструменты"** - список всех инструментов
- [x] **"Найди инструмент по ключевому слову"** - поиск
- [x] **"Дай ссылку на инструмент X"** - получение ссылки
- [x] **"Какие инструменты связаны с Y"** - фильтрация
- [x] **Неформальные вопросы** - дружелюбные ответы

### 3.4 Контекстная обработка ✅
- [x] Создать систему контекста для ИИ
- [x] Форматирование данных об инструментах
- [x] Системный промпт на русском языке
- [x] Тестирование различных типов вопросов

---

## Следующие этапы

### Уровень 4: Веб-интерфейс (Open WebUI) - следующий
- [ ] Установить и настроить Open WebUI
- [ ] Создать кастомный плагин для TableAgent
- [ ] Реализовать веб-интерфейс для:
  - [ ] Выбора Google Sheets таблицы
  - [ ] Просмотра содержимого таблицы
  - [ ] Чат-интерфейс с ИИ-агентом
  - [ ] Настройки параметров

### Дополнительные задачи

### Тестирование
- [x] Unit тесты для всех сервисов ✅
- [x] Integration тесты для Google Sheets API ✅
- [x] Тесты для ИИ-агента ✅
- [ ] E2E тесты для веб-интерфейса

### Документация
- [x] API документация (Swagger/OpenAPI) ✅
- [ ] Руководство пользователя
- [ ] Руководство разработчика
- [ ] Примеры использования

### Развертывание
- [ ] Docker контейнеризация
- [ ] Настройка CI/CD
- [ ] Конфигурация для production
- [ ] Мониторинг и логирование

---

## Критерии успеха

### Функциональные требования
- [x] Успешное подключение к Google Sheets ✅
- [x] Корректное чтение данных из таблицы ✅
- [x] Работающий ИИ-агент с точными ответами ✅
- [ ] Интуитивный веб-интерфейс (следующий этап)

### Технические требования
- [x] Время ответа < 5 секунд ✅
- [x] Обработка данных в реальном времени ✅
- [x] Поддержка до 1000 записей в таблице ✅
- [x] Стабильная работа API ✅

### Пользовательские требования
- [x] Простота использования API ✅
- [x] Понятные ответы ИИ на русском языке ✅
- [x] Быстрая навигация по данным ✅
- [ ] Мобильная адаптация (веб-интерфейс)

---

## Риски и митигация

### Технические риски
- **Google API лимиты** → Кэширование и оптимизация запросов
- **Производительность ИИ** → Выбор оптимальной модели
- **Безопасность данных** → Шифрование и безопасная аутентификация

### Проектные риски
- **Сложность интеграции** → Поэтапная разработка
- **Изменение требований** → Гибкая архитектура
- **Временные ограничения** → Приоритизация задач

---

## Временные рамки

- **Уровень 1**: 1-2 дня (планирование) ✅ ВЫПОЛНЕНО
- **Уровень 2**: 3-5 дней (Google Sheets + API) ✅ ВЫПОЛНЕНО
- **Уровень 3**: 2-3 дня (ИИ-агент) ✅ ВЫПОЛНЕНО
- **Уровень 4**: 2-3 дня (Open WebUI) - следующий
- **Тестирование и полировка**: 1-2 дня

**Общее время**: 7-12 дней
**Потрачено**: ~6 дней
**Осталось**: ~3-4 дня

---

## Текущий статус: ✅ Уровень 3 ЗАВЕРШЕН

**Что работает:**
- ✅ Google Sheets API интеграция
- ✅ ИИ-агент с glm-4.5-flash
- ✅ FastAPI с полным функционалом
- ✅ Тестирование через Postman
- ✅ Обработка всех типов вопросов

**Следующий шаг:** Создание веб-интерфейса с Open WebUI

*Последнее обновление: 17.01.2025*
*Статус: Готов к следующему этапу*
